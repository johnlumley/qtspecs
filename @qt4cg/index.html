<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2024/">2024</a>, <a href="2023/">2023</a>, <a href="2022/">2022</a>, <a href="2021/">2021</a>, <a href="2020/">2020</a></p><div class="toots">
<div class="toot" id="created-1402"><h2>Pull request #1402 created<span class="toot-id"> #created-1402</span></h2><div class="pubdate">25 Aug at 11:18:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1402">https://github.com/qt4cg/qtspecs/pull/1402</a></div><details><summary>Update schema for XSLT 4.0 to include agreed syntax changes</summary><div class="markup"><p>Updates the schema for XSLT 4.0 stylesheets to accommodate changes recently agreed:</p>
<ul>
<li>Support for xsl:function/@variadic</li>
<li>Support for extensions to decimal-format properties, for example <code>percent="%:pc"</code>.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1401"><h2>Issue #1401 created<span class="toot-id"> #created-1401</span></h2><div class="pubdate">23 Aug at 10:18:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1401">https://github.com/qt4cg/qtspecs/issues/1401</a></div><details><summary>Casting from duration to string</summary><div class="markup"><p>We've just been examining the rules for casting from duration / dayTimeDuration / yearMonthDuration to string (F+O section 20.1.1) and they are fairly impenetrable: I think we could do better.</p>
<ul>
<li>We use the phrase "canonical representation as defined in XSD 1.1 part 2"; a more specific reference would be helpful. Mentioning the function <code>·durationCanonicalMap·</code> would take readers straight to the right place.</li>
<li>The actual XSD spec has one or two typos, and uses some notations that might not be immediately obvious to every reader, for example <code>|m|</code> to mean <code>abs(m)</code>.</li>
</ul>
<p>I think the best answer to this is to add non-normative examples, which are badly missing from this whole section.</p>
<p>This would probably require splitting of 20.1.1 into subsections. Alternatively, we could add examples to the string() function, which would have the benefit that we have validation machinery to check that the examples under a specific function are correct; we could point to these examples from 20.1.1.</p>
</div></details></div>
<div class="toot" id="closed-1366"><h2>Issue #1366 closed<span class="toot-id"> #closed-1366</span></h2><div class="pubdate">22 Aug at 20:36:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1366">https://github.com/qt4cg/qtspecs/issues/1366</a></div><p>In the EBNF, use explicit separator syntax</p></div>
<div class="toot" id="created-1400"><h2>Pull request #1400 created<span class="toot-id"> #created-1400</span></h2><div class="pubdate">22 Aug at 18:49:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1400">https://github.com/qt4cg/qtspecs/pull/1400</a></div><details><summary>1395 Revise rules for subtyping of choice item types</summary><div class="markup"><p>Corrects/clarifies the rules for determining whether A is a subtype of B when either or both is a choice item type.</p>
<p>Fix #1395</p>
</div></details></div>
<div class="toot" id="created-1399"><h2>Issue #1399 created<span class="toot-id"> #created-1399</span></h2><div class="pubdate">22 Aug at 14:41:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1399">https://github.com/qt4cg/qtspecs/issues/1399</a></div><details><summary>XSLT fixed-namespaces - contradictory statements</summary><div class="markup"><p>We say:</p>
<blockquote>
<p>Any one of the strings xsl, xml, xs, xsi, fn, math, map, array, err. This has the effect of binding that particular namespace prefix to the [reserved namespace] with which it is conventionally associated, whether or not the [native namespace bindings] contain a binding for this prefix.</p>
</blockquote>
<blockquote>
<p>Note: ...</p>
</blockquote>
<blockquote>
<p>If the namespace prefix is explicitly bound to a different namespace, for example xmlns:math="java:java.util.Math", then that binding takes precedence.</p>
</blockquote>
<p>Given</p>
<p><code>&lt;xsl:stylsheet fixed-namespaces="math" xmlns:math="java:java.util.Math"&gt;</code></p>
<p>The normative statement implies that "java" is bound to <code>http://www.w3.org/2005/xpath-functions/math</code>, while the note implies it is bound to <code>"java:java.util.Math"</code> -- which surely makes more sense. I suspect the intended reading of the normative sentence is "whether or not the [native namespace bindings] contain this binding; but it needs clarifying/correcting.</p>
</div></details></div>
<div class="toot" id="created-1398"><h2>Pull request #1398 created<span class="toot-id"> #created-1398</span></h2><div class="pubdate">22 Aug at 08:59:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1398">https://github.com/qt4cg/qtspecs/pull/1398</a></div><details><summary>1397 Add missing change log entry for constructor functions</summary><div class="markup"><p>Fix #1397</p>
</div></details></div>
<div class="toot" id="created-1397"><h2>Issue #1397 created<span class="toot-id"> #created-1397</span></h2><div class="pubdate">22 Aug at 08:18:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1397">https://github.com/qt4cg/qtspecs/issues/1397</a></div><details><summary>Missing change log entry for zero-arity constructor functions</summary><div class="markup"><p>We've changed constructor functions to allow arity zero, but there is no change log entry for this.</p>
<p>Issue #658, PR #662</p>
</div></details></div>
<div class="toot" id="created-1396"><h2>Issue #1396 created<span class="toot-id"> #created-1396</span></h2><div class="pubdate">21 Aug at 23:45:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1396">https://github.com/qt4cg/qtspecs/issues/1396</a></div><details><summary>Rendition of EBNF syntax scraps</summary><div class="markup"><p>In the EBNF syntax tabulation, the column width available for the RHS of productions is rather limited, leading to excessive line wrapping, especially where the entire syntax is displayed in Appendix A.</p>
<p>I haven't been entirely successful in sorting this out, but record my experiments here.</p>
<p>(a) In the CSS stylesheet qtspecs.css line 169, change the padding from 30px to 10px</p>
<p>(b) remove all the non-breaking spaces that are inserted after the production number and around the <code>::=</code> operator. (Search for <code>::=</code> in xmlspec-2016.xsl</p>
<p>(c) get rid of the tbody element that surrounds each tr by putting the productions in a prodgroup, achieved by adding a prodgroup element around the line <code>&lt;prodrecap id="BNF-Grammar-prods" ref="BNF-Grammar-prods"/&gt;</code> (line 43 of ebnf.xml)</p>
<p>Unfortunately this doesn't seem to allocate extra width to the columns, it merely creates extra whitespace to the right of the table. I can't work out why that is happening.</p>
<p>Another step would be to remove the final right-hand column containing comments, instead moving the comments to be under the RHS of the production. But the logic here is complex...</p>
<p>Finally, a pragmatic move would be to reduce the length of the longest production names, such as <code>FunctionSignatureWithDefaults</code>, which bloat the width of the LH column.</p>
</div></details></div>
<div class="toot" id="closed-1315"><h2>Issue #1315 closed<span class="toot-id"> #closed-1315</span></h2><div class="pubdate">21 Aug at 22:19:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1315">https://github.com/qt4cg/qtspecs/issues/1315</a></div><p>12 div-3</p></div>
<div class="toot" id="created-1395"><h2>Issue #1395 created<span class="toot-id"> #created-1395</span></h2><div class="pubdate">21 Aug at 16:57:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1395">https://github.com/qt4cg/qtspecs/issues/1395</a></div><details><summary>Choice item types: subtyping</summary><div class="markup"><p>We say: [with the example changed for clarity]</p>
<blockquote>
<p>3.3.2.2 Choice Item Types</p>
<p>[1] If B is a [choice item type], then A ⊆ B is true if A ⊆ M is true for some item type M among the alternatives of B.</p>
<p>[2] If A is a [choice item type], then A ⊆ B is true if M ⊆ B is true for every item type M among the alternatives of A.</p>
<p>Note:</p>
<p>Because an [enumeration type] is defined as a choice type of singleton enumerations, these rules have the consequence, for example, that enum("P", "Q") is a subtype of enum("P", "Q", "R").</p>
</blockquote>
<p>Now, the first condition [1] doesn't hold: <code>enum("P", "Q")</code> is not a subtype of <code>enum("P")</code>, nor of <code>enum("Q")</code>, nor of <code>enum("R")</code>.</p>
<p>But the second condition [2] does hold: <code>enum("P")</code> and <code>enum("Q")</code> are both subtypes of <code>enum("P", "Q", "R")</code>, under rule [1].</p>
<p>So the rules are far from clear when both A and B are choice item types.</p>
<p>I think it probably needs a combined rule.</p>
<p>(i) if both A and B are choice item types, then A ⊆ B is true if every item type a among the alternatives of A satisfies a ⊆ b for some item type b among the alternatives of B.</p>
<p>The existing two rules are really just special cases of that for singleton choices.</p>
</div></details></div>
<div class="toot" id="created-1394"><h2>Issue #1394 created<span class="toot-id"> #created-1394</span></h2><div class="pubdate">20 Aug at 16:26:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1394">https://github.com/qt4cg/qtspecs/issues/1394</a></div><details><summary>XSLT Default priority for `element(p:*)` etc</summary><div class="markup"><p>There are new possibilities for node tests used as XSLT patterns, for example <code>element(p:*)</code>, <code>element(*:local)</code>, <code>element(p:*, T)</code>, <code>element(*:local, T)</code>. These need to have default priorities assigned.</p>
</div></details></div>
<div class="toot" id="created-1393"><h2>Pull request #1393 created<span class="toot-id"> #created-1393</span></h2><div class="pubdate">19 Aug at 10:48:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1393">https://github.com/qt4cg/qtspecs/pull/1393</a></div><details><summary>1391 Change function-annotations to return a sequence</summary><div class="markup"><p>Fix #1391</p>
<ul>
<li>Changes the data model to clarify exactly what the annotations of a function item are</li>
<li>Clarifies the XQuery description of what effect annotations in the query prolog have</li>
<li>Changes the fn:function-annotations function to return a sequence of key value pairs in which there can be duplicate keys.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1392"><h2>Issue #1392 created<span class="toot-id"> #created-1392</span></h2><div class="pubdate">18 Aug at 20:57:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1392">https://github.com/qt4cg/qtspecs/issues/1392</a></div><details><summary>`element(a|b)` vs `(element(a)|element(b))`</summary><div class="markup"><p>We have introduced two syntax extensions which achieve the same effect:</p>
<p><code>element(a|b)</code> vs <code>(element(a)|element(b))</code></p>
<p>Do we actually want both?</p>
<p>If we do, I would suggest that we define <code>element(a|b)</code> as a shorthand for <code>(element(a)|element(b))</code>.</p>
<p>Are they actually equivalent? I think it's fairly clear that they match the same items. It's less clear what the subtyping rules have to say. I think each is a subtype of the other, which means they are substitutable for each other in a function signature, but it needs a lot of digging in the spec to demonstrate this. Are they equivalent from the point of view of coercion rules? I think they probably are, because no coercion actually takes place when the required type is a node type.</p>
<p>So I think there's no technical bug here just a lack of clarity. It would be easier (assuming we want to retain the syntax at all) if we defined <code>element(a|b)</code> as a shorthand for <code>(element(a)|element(b))</code>.</p>
<p>Minor editorial issues:</p>
<ul>
<li>In 3.2.7.2 example 5 is incorrect -- <code>element(xhtml:*|svg:*|mathml|*)</code> - the last <code>|</code> should be <code>:</code>.</li>
<li>In the changes section of 3.2.7.2, the <code>element(A|B)</code> syntax is not mentioned.</li>
</ul>
</div></details></div>
<div class="toot" id="created-1391"><h2>Issue #1391 created<span class="toot-id"> #created-1391</span></h2><div class="pubdate">16 Aug at 19:54:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1391">https://github.com/qt4cg/qtspecs/issues/1391</a></div><details><summary>Annotations: duplicate names</summary><div class="markup"><p>The function <code>fn:function-annotations</code> returns a map from QNames to values, which rather assumes that a function cannot have two annotations with the same name. But there is nothing in either the data model or the XQuery language spec that imposes this restriction.</p>
</div></details></div>
<div class="toot" id="created-1390"><h2>Pull request #1390 created<span class="toot-id"> #created-1390</span></h2><div class="pubdate">16 Aug at 17:18:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1390">https://github.com/qt4cg/qtspecs/pull/1390</a></div><details><summary>1368 built in keywords improvements</summary><div class="markup"><p>Rewrite of stylesheet for generating keyword tests</p>
</div></details></div>
<div class="toot" id="created-1389"><h2>Issue #1389 created<span class="toot-id"> #created-1389</span></h2><div class="pubdate">15 Aug at 09:02:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1389">https://github.com/qt4cg/qtspecs/issues/1389</a></div><details><summary>fn:while-do: Optional error: will not terminate</summary><div class="markup"><p>In many cases, a compiler may detect that a <code>fn:while-do</code> or <code>fn:do-until</code> function call will not terminate. Trivial examples:</p>
<pre><code class="language-xquery">while-do((), true#0, identity#1)
while-do((), exists#1, fn($c) { $c, $c }
</code></pre>
<p>We should add a fixed error code that an implementation sʜᴏᴜʟᴅ (or ᴍᴀʏ?) raise when it encounters such a case. The error can be raised statically (e.g., as the result of type checks) or dynamically (when the input is not known at compile time). We could reuse <code>XQDY0054</code>.</p>
<p>In principle, the error code could also be used to reject non-terminating recursive functions:</p>
<pre><code class="language-xquery">declare function local:rec() { local:rec() };
local:rec()

declare function local:duplicate($input) {
  if(exists($input)) then $input else local:duplicate(($input, $input))
};
local:duplicate(())

let $oh := fn($my) { $my($my) }
return $oh($oh)

(: if we legalize this, see #1379 :)
declare variable $rec := fn() { $rec };
$rec()
</code></pre>
</div></details></div>
<div class="toot" id="created-1388"><h2>Pull request #1388 created<span class="toot-id"> #created-1388</span></h2><div class="pubdate">14 Aug at 10:26:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1388">https://github.com/qt4cg/qtspecs/pull/1388</a></div><details><summary>Attempt to resolve #1387 by clarifying the encoding rules</summary><div class="markup"><p>I decided to put this in a separte PR so that it can be reviewed in isolation. I don't expect it to be controversial, exactly, but it may require adjustment.</p>
</div></details></div>
<div class="toot" id="created-1387"><h2>Issue #1387 created<span class="toot-id"> #created-1387</span></h2><div class="pubdate">13 Aug at 15:55:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1387">https://github.com/qt4cg/qtspecs/issues/1387</a></div><details><summary>fn:build-uri: Observations</summary><div class="markup"><p>@ndw I’ll again start with a single test case, <a href="https://github.com/qt4cg/qt4tests/blob/b5c9431b6e5c7e24729a4de19aac1754b0b34c4a/fn/build-uri.xml#L296-L314">fn-build-uri-from-parse-020</a>:</p>
<pre><code class="language-xml">&lt;test-case name="fn-build-uri-from-parse-020"&gt;
    &lt;description&gt;Builds an example from the specification&lt;/description&gt;
    &lt;created by="Norm Tovey-Walsh" on="2023-03-10"/&gt;
    &lt;test&gt;fn:build-uri(map {
  "uri": "ldap://[2001:db8::7]/c=GB?objectClass?one",
  "scheme": "ldap",
  "authority": "[2001:db8::7]",
  "host": "[2001:db8::7]",
  "path": "/c=GB",
  "query": "objectClass?one",
  "query-parameters": map {
    "": "objectClass?one"
  },
  "path-segments": ("", "c=GB")
})&lt;/test&gt;
    &lt;result&gt;
      &lt;assert-eq&gt;"ldap://[2001:db8::7]/c=GB?objectClass?one"&lt;/assert-eq&gt;
    &lt;/result&gt;
  &lt;/test-case&gt;
</code></pre>
<p>I would expect <code>ldap://[2001:db8::7]/c=GB?=objectClass%3Fone</code> as result, as the spec says…</p>
<blockquote>
<p>If the <code>query-parameters</code> key exists in the map, its value must be a map. A sequence of strings is constructed from the values in the map. For each key and each <em>value</em> associated with that <em>key</em> in turn:</p>
<ul>
<li>If the <em>key</em> is the empty string, the string constructed is the <em>value</em> encoded with <code>encode-for-uri</code>.</li>
</ul>
</blockquote>
<p>…and <code>encode-for-uri('?')</code> gives us <code>%3F</code>. How do you handle that in your code?</p>
</div></details></div>
<div class="toot" id="created-1386"><h2>Pull request #1386 created<span class="toot-id"> #created-1386</span></h2><div class="pubdate">13 Aug at 10:43:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1386">https://github.com/qt4cg/qtspecs/pull/1386</a></div><details><summary>1382 add error code XTSE4040</summary><div class="markup"><p>Fix #1382</p>
</div></details></div>
<div class="toot" id="created-1385"><h2>Issue #1385 created<span class="toot-id"> #created-1385</span></h2><div class="pubdate">13 Aug at 09:04:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1385">https://github.com/qt4cg/qtspecs/issues/1385</a></div><details><summary>Quantifier expressions: optional positional argument</summary><div class="markup"><p>This has been requested multiple times before (albeit not in this repository): What about adding a positional argument to quantifier expressions? It it simple to implement, and it would allow us to do things like…</p>
<pre><code class="language-xquery">every $item at $pos in $input satisfies $item = $pos * 2
</code></pre>
<p>…which would be equivalent to…</p>
<pre><code class="language-xquery">every($input, fn($item, $pos) { $item = $pos * 2 })
</code></pre>
<p>…and much better to read than e.g.…</p>
<pre><code class="language-xquery">not((for $item at $pos in $input return $item = $pos * 2) = false())
</code></pre>
</div></details></div>
<div class="toot" id="created-1384"><h2>Pull request #1384 created<span class="toot-id"> #created-1384</span></h2><div class="pubdate">13 Aug at 08:49:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1384">https://github.com/qt4cg/qtspecs/pull/1384</a></div><details><summary>1316 Type declarations in quantified expressions</summary><div class="markup"><p>Fix #1316</p>
<ol>
<li>Quantified expressions now allow a type declaration in both XQuery and XPath</li>
<li>A type declaration now induces coercion of the supplied value to the required type</li>
</ol>
</div></details></div>
<div class="toot" id="created-1383"><h2>Pull request #1383 created<span class="toot-id"> #created-1383</span></h2><div class="pubdate">12 Aug at 21:44:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1383">https://github.com/qt4cg/qtspecs/pull/1383</a></div><details><summary>1374 - allow static error for duplicate keys</summary><div class="markup"><p>Fix #1374</p>
</div></details></div>
<div class="toot" id="created-1382"><h2>Issue #1382 created<span class="toot-id"> #created-1382</span></h2><div class="pubdate">12 Aug at 17:15:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1382">https://github.com/qt4cg/qtspecs/issues/1382</a></div><details><summary>Missing XSLT error code</summary><div class="markup"><p>§2.7.4 says:</p>
<p>If R has an as attribute, the SequenceType S declared by R must be a subtype of T, according to the relationship subtype(S, T) defined in [].</p>
<p>There is no allocated error code, I propose to allocate XTSE4040.</p>
</div></details></div>
<div class="toot" id="created-1381"><h2>Issue #1381 created<span class="toot-id"> #created-1381</span></h2><div class="pubdate">12 Aug at 15:09:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1381">https://github.com/qt4cg/qtspecs/issues/1381</a></div><details><summary>fn:parse-uri: Observations (cont.)</summary><div class="markup"><p>The rules for <code>fn:parse-uri</code> say:</p>
<blockquote>
<p>If the fragment is the empty string, it is discarded and the fragment is the empty sequence.</p>
</blockquote>
<p>However, the result of <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/fn/parse-uri.xml#L746-L762">fn-parse-uri-043</a> contains an empty fragment string:</p>
<pre><code class="language-xml">&lt;test-case name="fn-parse-uri-043"&gt;
    &lt;description&gt;Parses a URI ending in "#"&lt;/description&gt;
    &lt;created by="Michael Kay" on="2023-10-27"/&gt;
    &lt;test&gt;fn:parse-uri("https://qt4cg.org/specifications/xpath-functions-40/Overview.html#")&lt;/test&gt;
    &lt;result&gt;
      &lt;assert-deep-eq&gt;map {
        "authority": "qt4cg.org",
        "fragment": "",
        "host": "qt4cg.org",
        "path": "/specifications/xpath-functions-40/Overview.html",
        "path-segments": ("", "specifications", "xpath-functions-40", "Overview.html"),
        "scheme": "https",
        "hierarchical": true(),
        "uri": "https://qt4cg.org/specifications/xpath-functions-40/Overview.html#"
        }&lt;/assert-deep-eq&gt;
    &lt;/result&gt;
  &lt;/test-case&gt;
</code></pre>
<p>I assume the tests should be updated?</p>
<p>With regard to the spec, I would suggest adding the normalization rule to query parameters:</p>
<blockquote>
<p>If the <em>query</em> is the empty string, it is discarded and the <em>query</em> is the empty sequence.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-1380"><h2>Pull request #1380 created<span class="toot-id"> #created-1380</span></h2><div class="pubdate">12 Aug at 12:50:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1380">https://github.com/qt4cg/qtspecs/pull/1380</a></div><details><summary>1320 Attempt to resolve a bug in parse-uri</summary><div class="markup"><p>Fix #1320</p>
<p>(A speculative PR in the hope that my proposed resolution is acceptable.)</p>
</div></details></div>
<div class="toot" id="created-1379"><h2>Issue #1379 created<span class="toot-id"> #created-1379</span></h2><div class="pubdate">12 Aug at 11:30:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1379">https://github.com/qt4cg/qtspecs/issues/1379</a></div><details><summary>Circular dependencies: XQDY0054 vs. XPST0008 vs. optional errors</summary><div class="markup"><p>It remains a challenge (for me) to understand how the specification expects implementations to handle circular dependencies. Sorry in advance for mixing up the specification, tests and the behavior of Saxon (it basically demonstrates my confusion):</p>
<h3>Error Codes</h3>
<p>The definition of <code>err:XPST0008</code> is:</p>
<blockquote>
<p>It is a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-static-error">static error</a> if an expression refers to an element name, attribute name, schema type name, namespace prefix, or variable name that is not defined in the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-static-context">static context</a>, except for an ElementName in an <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-ElementTest">ElementTest</a> or an AttributeName in an <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-AttributeTest">AttributeTest</a>.</p>
</blockquote>
<p>The definition of <code>err:XQDY0054</code> is:</p>
<blockquote>
<p>It is a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#dt-dynamic-error">dynamic error</a> if a cycle is encountered in the definition of a module’s dynamic context components, for example because of a cycle in variable declarations.</p>
</blockquote>
<h3>Queries</h3>
<p>The following test case <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/prod/VarDecl.xml#L1527C21-L1537">K-InternalVariablesWith-15b</a> expects <code>XPST0008</code> as error:</p>
<pre><code class="language-xquery">declare variable $var1 := $var1;
true()
</code></pre>
<p>I would expect <code>XQDY0054</code> as error, and <code>true()</code> to be a valid alternative, as <code>$var1</code> is indeed defined in the static context. Think of a similar query (for which I would as well expect <code>XQDY0054</code> or <code>true()</code> to be correct results):</p>
<pre><code class="language-xquery">declare variable $var1 := $var2;
declare variable $var2 := $var1;
true()
</code></pre>
<p>Saxon outputs  the following error for the first query…</p>
<blockquote>
<p>[XPST0008] Circular definition of global variable: $var1 uses $var1.</p>
</blockquote>
<p>…which is confusing in itself, as the error code and the message do not really match. The output of the second query is consistent:</p>
<blockquote>
<p>[XQDY0054] Circular definition of global variable: $var2 uses $var1, which uses $var2.</p>
</blockquote>
<p>Another test case that expects <code>XQDY0054</code> is <a href="https://github.com/qt4cg/qt4tests/blob/4659dfdcc92ac57c9a7f482a1ec9f3f509020f52/prod/VarDecl.xml#L1582-L1591">K-InternalVariablesWith-17a</a>:</p>
<pre><code class="language-xquery">declare variable $var := local:func1();
declare function local:func1() { local:func2($var) };
declare function local:func2($arg2) { 1 };
true()
</code></pre>
<p>Again, I would expect <code>true()</code> to be a valid alternative, in <code>K-InternalVariablesWith-17</code> (the original XQuery 1.0 test), the rational for reporting an error was…</p>
<blockquote>
<p>A prolog variable having a circular dependency, by having a variable reference in a call site argument. This is an error even though the variable isn't used, because implementations cannot skip reporting static errors.</p>
</blockquote>
<p>…but we now have a dynamic error.</p>
<h3>Suggestions</h3>
<ol>
<li><code>XPST0008</code> should only be raised if no declaration exists for that variable in the query prolog.</li>
<li><code>XQDY0054</code> should be optional for cases in which the affected code is never evaluated.</li>
</ol>
<p>I would like to hear some feedback on this, and I will be happy to move the corresponding questions to <code>qt4tests</code> and/or the Saxon bug tracker if we believe that the spec is comprehensive enough.</p>
</div></details></div>
<div class="toot" id="closed-1376"><h2>Issue #1376 closed<span class="toot-id"> #closed-1376</span></h2><div class="pubdate">12 Aug at 10:09:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1376">https://github.com/qt4cg/qtspecs/issues/1376</a></div><p>User defined operators</p></div>
<div class="toot" id="created-1378"><h2>Pull request #1378 created<span class="toot-id"> #created-1378</span></h2><div class="pubdate">12 Aug at 10:07:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1378">https://github.com/qt4cg/qtspecs/pull/1378</a></div><details><summary>1375 - bugs in pattern syntax</summary><div class="markup"><ol>
<li>Changes the pattern syntax to allow any EQName to be used for function calls; the constraints on which functions can be called are defined outside the actual grammar.</li>
<li>Reinstate root() as a permitted function</li>
<li>Allow <code>doc()/id()</code> without requiring parentheses around the second function call</li>
<li>Stylesheet changes to point external spec references at the 4.0 specs rather than 3.0.</li>
</ol>
<p>Fix #1375</p>
</div></details></div>
<div class="toot" id="closed-1377"><h2>Issue #1377 closed<span class="toot-id"> #closed-1377</span></h2><div class="pubdate">12 Aug at 08:50:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1377">https://github.com/qt4cg/qtspecs/pull/1377</a></div><p>Fix inconsistent definition of return-type-ref-occurs</p></div>
<div class="toot" id="created-1377"><h2>Pull request #1377 created<span class="toot-id"> #created-1377</span></h2><div class="pubdate">12 Aug at 08:50:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1377">https://github.com/qt4cg/qtspecs/pull/1377</a></div><details><summary>Fix inconsistent definition of return-type-ref-occurs</summary><div class="markup"><p>The DTD defines it as a IDREF type which it clearly isn't.</p>
</div></details></div></div><p>See 2729
            more statuses in yearly archives.</p></article></main></body></html>