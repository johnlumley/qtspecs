<item>
   <title>Issue #1318 created</title>
   <pubDate>2024-07-09T08:30:31Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1318</link>
   <guid>https://qt4cg.org/@qt4cg/2024/#created-1318</guid>
   <description>&lt;div&gt;&lt;p&gt;Function Coercion: Records, Maps, Arrays&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;I like to question the coercion rule that encompasses record tests:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ol start="6"&gt;
&lt;li&gt;If &lt;em&gt;R&lt;/em&gt; is a &lt;a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#doc-xquery40-RecordTest"&gt;RecordTest&lt;/a&gt; and &lt;em&gt;J&lt;/em&gt; is a map, then J is converted to a new map as follows:&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;The keys in the supplied map are unchanged.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;In any map entry whose key is an &lt;code&gt;xs:string&lt;/code&gt; equal to the name of one of the field declarations in R, the corresponding value is converted to the required type defined by that field declaration, by applying the coercion rules recursively (but with XPath 1.0 compatibility mode treated as false).&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;I would like us to drop this rule. I believe that both the instance checks and the conversions of large maps can get very expensive. In addition, it may even require recursive rebuilds of map structures if a supplied record test includes nested record tests.&lt;/p&gt;
&lt;p&gt;I think itâ€™s completely fair to expect users to deliver maps in a way that matches record definitions, and it could even be counterintuitive if map updates take place as a consequence of a simple function call.&lt;/p&gt;
&lt;p&gt;If we want to stick to that coercion rule, we should also define coercion rules for maps and arrays.&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
