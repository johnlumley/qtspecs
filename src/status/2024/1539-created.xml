<item>
   <title>Issue #1539 created</title>
   <pubDate>2024-10-29T18:38:26Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1539</link>
   <guid>https://qt4cg.org/@qt4cg/2024/#created-1539</guid>
   <description>&lt;div&gt;&lt;p&gt;New function: System’s default time zone for arbitrary date/time values.&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;It is not easy to find out the correct timezone for a given UTC &lt;code&gt;xs:dateTime&lt;/code&gt; in the current region. We have &lt;code&gt;fn:implicit-timezone&lt;/code&gt;, but it only refers to the current date and time.&lt;/p&gt;
&lt;p&gt;The following code works for at least BaseX and Saxon; it applies the system’s default time zone to a given &lt;code&gt;xs:dateTime&lt;/code&gt; item:&lt;/p&gt;
&lt;pre&gt;&lt;code class="language-xquery"&gt;let $dtm := xs:dateTime('2024-07-01T01:01:01Z')
let $ms := xs:integer(($dtm - xs:dateTime('1970-01-01T00:00:00Z')) div xs:dayTimeDuration('PT0.001S'))
let $tz := xs:dayTimeDuration('PT' ||
  Q{java:java.time.ZonedDateTime}ofInstant(
    Q{java:java.time.Instant}ofEpochMilli($ms),
    Q{java:java.time.ZoneId}systemDefault()
  )
  =&amp;gt; Q{java:java.time.ZonedDateTime}getOffset()
  =&amp;gt; Q{java:java.time.ZoneOffset}getTotalSeconds()|| 'S')
return adjust-dateTime-to-timezone($dtm, $tz)
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It returns &lt;code&gt;2024-07-01T03:01:01+02:00&lt;/code&gt; (MESZ) on systems located in Leipzig and nearby cities.&lt;/p&gt;
&lt;p&gt;We could either introduce a function that&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;returns an &lt;code&gt;xs:dayTimeDuration&lt;/code&gt; timezone for a given &lt;code&gt;xs:dateTime&lt;/code&gt; item (with the system’s default time zone applied), or&lt;/li&gt;
&lt;li&gt;converts an &lt;code&gt;xs:dateTime&lt;/code&gt; item to the system’s default time zone at the given date/time.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Suggestions for good names are welcome.&lt;/p&gt;
&lt;p&gt;See also https://xmlcom.slack.com/archives/C01GVC3JLHE/p1730216267200449:&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
