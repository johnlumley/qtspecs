<item>
   <title>Issue #1493 created</title>
   <pubDate>2024-10-10T14:35:44Z</pubDate>
   <link>https://github.com/qt4cg/qtspecs/issues/1493</link>
   <guid>https://qt4cg.org/@qt4cg/2024/#created-1493</guid>
   <description>&lt;div&gt;&lt;p&gt;fn:xml-to-json: Amendments&lt;/p&gt;&lt;div class="markup"&gt;&lt;p&gt;Maybe I was too quick in waving through #1476 as I believe that the current version is a bit sketchy. It says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An element &lt;code&gt;$E&lt;/code&gt; named &lt;code&gt;number&lt;/code&gt; is processed by copying the string value of &lt;code&gt;$E&lt;/code&gt; to the output, making any changes that are necessary to ensure that the result is a valid JSON number. Such changes include:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Removing leading and trailing whitespace.&lt;/li&gt;
&lt;li&gt;Removing a leading plus sign.&lt;/li&gt;
&lt;li&gt;Removing redundant leading zero digits.&lt;/li&gt;
&lt;li&gt;Adding a zero digit before or after a decimal point that is not preceded and followed by a digit.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;ol&gt;
&lt;li&gt;For input like &lt;code&gt;X&lt;/code&gt;, we cannot ensure that it will be a valid JSON number, so I assume that the changed string needs to be validated before being output?&lt;/li&gt;
&lt;li&gt;“Removing redundant leading zero digits” may not consider negative number like &lt;code&gt;-01&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Does “Such changes include” imply that the list may not be comprehensive?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In many cases, the numbers to be output will be the result of an earlier &lt;code&gt;json-to-xml&lt;/code&gt; conversion. If it is generated with XPath numbers, we shouldn’t encounter plus signs, redundant leading zeros etc. either, so I would suggest getting rid of all post-processing. We could simply say:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An element &lt;code&gt;$E&lt;/code&gt; named &lt;code&gt;number&lt;/code&gt; results in the output of the string value of the element if it is a valid JSON number. Otherwise, &lt;code&gt;[FOJS0006]&lt;/code&gt; is raised.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;If we do want to tweak the string value, we should provide a complete set of rules; maybe something like…&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The string value of an element &lt;code&gt;$E&lt;/code&gt; named &lt;code&gt;number&lt;/code&gt; is modified by:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;removing leading and trailing whitespace,&lt;/li&gt;
&lt;li&gt;removing a single leading plus sign,&lt;/li&gt;
&lt;li&gt;removing redundant leading zero digits, which are optionally preceded by a leading minus sign,&lt;/li&gt;
&lt;li&gt;adding a zero digit before a decimal point that is not preceded by a digit, and&lt;/li&gt;
&lt;li&gt;adding a zero digit after a decimal point that is not followed by a digit.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If the result is a valid JSON number, it is output. Otherwise, &lt;code&gt;[FOJS0006]&lt;/code&gt; is raised.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;…but that’s still fuzzy (for example, it lacks the explanation of what redundant zero digits are).&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
</item>
